# [Advent Calendar 2025 オープンソース半導体](https://qiita.com/advent-calendar/2025/osssilicon)の3日目の記事

## [Wafer.Sapce GF180 Run 1 への投稿完了！！！](https://ishi-kai.org/waferspace/shuttle/gf180/2025/12/01/shuttle_ISHI-KAI_Multiple_Projects_WaferSapce-GF180-1_submitted.html)の続報
「[Wafer.Sapce GF180 Run 1 への投稿完了！！！](https://ishi-kai.org/waferspace/shuttle/gf180/2025/12/01/shuttle_ISHI-KAI_Multiple_Projects_WaferSapce-GF180-1_submitted.html)」で報告したWafer.Sapce GF180 Run 1ですが、投稿後にPDKがアップデートしたため対応を行いました。  
  
2025/12/04に、DRCにCUPとアンテナルールが追加され、もろに引っかかったので、3000を超えるエラーが出ました。これを一つずつ、手直ししたので3日ほど要しましたが、無事に全部Fixできました。  
  
これで終わったと思いきや2025/12/10に、バグ修正レベルのアップデートが入ったのですが、これがかなり痛かったです。これにより、3.3Vと5VのFETチェックにあったバグが修正されて、3.3Vと5VのFETの違いがチェックされるようになりました。そして、一部のレイアウトでこれを混ぜて使用しているものがあり、それをすべて修正したためこれも3日ほどかかりました。  
ただし、これに時間がかかったのは、一部のエラーが出るレイアウトだけを抜き出すとエラーが出なくなるというバグがあり、ある程度複数のレイアウトと同時にチェックしなければならず、DRCチェックに20分以上かかるようになってしまったというのが大きな原因です。  
  
やはり、第一回目ということもあり、ドタバタしていますね！これはこれでこのようなサービスの立ち上げを生で見られて良い経験となっております。  
[2025年12月イベント「東海理化シャトルのオープンPDK解説会」](https://github.com/noritsuna/AdventCalendar2025/blob/main/OSSSilicon_Day_08.md)で開設予定の東海理化シャトルのオープンPDKも来年は本格立ち上げとのことなので、このような光景が見られるかもしれません。  
***このあたりをサポートしてくれる人を募集中とのことです！***  
  

ちなみに、TOは2025/12/17(日本時間で2025/12/18)なったのですが、ギリギリもギリギリまでPDKはアップデートされていました。（ISHI会はすべてのPDK対応しています。）  
  - ![TO日程](/images/WS_RUN1_TO_DATE.png)


### DRC内容
少なくともアンテナルールのDRCは当初はWafer.Space側としては「ファブに対して無視して作ってくれ。」と交渉していたらしいですが「だめ！」って言われて対応することになったようです。  
実際に、アンテナルールに関しては「理論的には起きるけど、可能性は低い」ってものなので「壊れても文句言わないからエラーは無視して作ってくれ」というと対応してくれることが多いDRCの一つです。  

- CUP
    - Padに対して接続されているメタル線が細すぎる場合に出力される
        - 本質的には大きなメタルに対して、接続されているメタルの幅の比が大きくなりすぎる場合に出るエラー。エッチング時などに大きいものに対してい小さすぎる場合影響がでかくなるためである（通常よりも侵食が進む）。
    - 対策
        - 図のように鏡餅のように段々と細くなるようにメタルを作る
        - ![配線例](/images/WS_CUP_01.png)
- アンテナルール
    - Gateに接続されているメタル線が長すぎる場合に出力される
        - 本質的には大きな面積を持つメタルが接続される場合に出るエラー。面積が大きいメタル＝保持される電荷量も大きいということであり、大電流によりGateの酸化膜の絶縁破壊が起きる可能性があるためである。
    - 対策
        - メタル線を分割する＝M1 -> M2 -> M3 というような感じでM1など一層だけ使わずに複数層を使って線を引く
            - ![配線例](/images/WS_ANT_01.png)
        - メタル線にサージ対策（TVS）としてのダイオードを付加する
            - 今回はこれは行わなかった。理由は「ダイオードが無視される」という現象が出ていたため。この原因は「PDK 1.4.1」で修正されているが「PDK 1.3.1」で修正を行なっていたため、気が付かずにこの対策を諦めたためである。
            - ![配線例](/images/WS_ANT_02.png)


### PDKアップデート履歴
- 2025/12/04
    - PDK 1.3.1
        - Implement CUP.2 and CUP.3 rules.
        - Modify the pad library to conform to CUP.2 and CUP.3.
        - Flatten the guard ring and merge the marker polygons.
        - Correct ANTENNAGATEPLUSDIFF in the techlef for thick oxide devices. (thanks @egor!)
    - Project template 1.2.2
        - Update the PDK to 1.3.1.
        - Enable KLayout antenna checks by default.
        - Add a script to generate standalone padrings for analog designs.
- 2025/12/05
    - PDK 1.4.1
        - Fix the connectivity setup in KLayout DRC.
        - Check for both P/N-type diodes in the KLayout antenna script. (thanks @tnt!)
    - Project template 1.2.3
- 2025/12/07
    - PDK 1.4.4
        - Skip certain checks in the KLayout antenna script if corresponding layers are empty. Correctly check the top metal layer. (thanks @Egor Lukyanchenko!)
        - Don't consider dummy metal in the KLayout antenna script (already handled by the DRC rules).
        - Actually check for both P/N-type diodes in the KLayout antenna script. (thanks again @tnt!)
    - Project template 1.2.5
- 2025/12/10
    - PDK 1.6.3
        - Correctly implement antenna checks based on ANTENNADIFFSIDEAREARATIO.
        - Fix shorts in the antenna connectivity setup.
        - Update the magic tech file from open_pdks.
        - Filler generation:
            - Comply with DPF.12, DPF.13, DM.4_DM.6, DM.5_DM.7 and DPF.1.
            - Add option to the filler generation to move a dummy metal layer to active metal and ignore DM.4_DM.6 and DM.5_DM.7.
    - Project template 1.3.0
        - Update the LibreLane branch.
        - Enable active dummy fill for Metal2 layer.
    - Precheck 1.5.0
        - Update the LibreLane branch.
- 2025/12/10
    - PDK 1.6.4
        - Keep fill on dummy metal layers.
        - Rename option to Metaln_ignore_active.
    - Project template 1.3.1
        - Update the PDK and use the new filler option for Metal2.
    - Precheck 1.5.1
        - Move dummy metal shapes to active metal.
- 2025/12/15
    - PDK 1.6.5
        - This update makes magic DRC optional: magic DRC violations won't block the submission process.
        - This decision was made due to a number of false positive errors that can show up if you read in a layout in magic that was not generated by magic.
        - However, please note that you should still closely verify all magic DRC violations. If you have any doubts, or magic catches a DRC violation that KLayout does not, please let us know.
        - The other change is that the antenna check will also consider nwell-to-pcomp diodes. Previously, it only considered pcomp-to-nwell and nplus-to-substrate diodes.
        - These structures are found inside the foundry-provided I/O cells, so this change should help reduce antenna violations in some cases.
    - Project Template 1.3.3
    - Precheck 1.5.3
- 2025/12/16
    - PDK 1.6.6
    - Project Template 1.3.5
    - Precheck 1.5.4
        - This update fixes a regression introduced in the previous update (sorry!).
